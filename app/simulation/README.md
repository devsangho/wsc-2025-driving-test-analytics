# 태양광 자동차 주행 시뮬레이션 알고리즘

이 문서는 태양광 자동차 주행 시뮬레이션의 알고리즘을 상세하게 설명합니다. 시뮬레이션은 월드 솔라 챌린지(WSC) 2025 대회를 기준으로 구현되었으며, 태양광 자동차의 실제 주행 특성과 에너지 관리를 현실적으로 모델링합니다.

## 1. 시뮬레이션 개요

시뮬레이션은 다음 주요 요소를 포함합니다:

- 경로 계획 및 관리
- 태양광 발전량 계산
- 모터 에너지 소비량 계산
- 배터리 충전 및 방전 모델링
- 지형 데이터 기반 에너지 소비 예측
- 날씨 데이터 기반 발전량 예측
- 컨트롤 스탑 및 충전 전략

시뮬레이션의 목표는 주어진 차량 사양, 경로, 날씨 조건에서 태양광 자동차의 주행 가능성을 평가하고, 최적의 주행 전략을 도출하는 것입니다.

## 2. 핵심 모듈 구조

시뮬레이션은 다음 핵심 모듈로 구성됩니다:

1. **라우트 플래너(RouteItinerary)**: 전체 경로 계획 생성
2. **세그먼트 플래너(RouteSegmentPlanner)**: 일일 주행 세그먼트 관리
3. **에너지 계산기(EnergyCalculator)**: 에너지 소비 및 생산 계산
4. **모터 모델(MotorModel)**: 차량 속도와 부하에 따른 에너지 소비 모델링
5. **배터리 모델(BatteryModel)**: 배터리 충전/방전 특성 모델링
6. **지형 유틸리티(TerrainUtils)**: 경로의 고도 및 경사도 처리
7. **날씨 데이터 처리기(WeatherDataProcessor)**: 태양광 발전량 예측

## 3. 시뮬레이션 파라미터

시뮬레이션에서 사용되는 주요 파라미터는 다음과 같습니다:

### 차량 사양
- **차량 질량**: 기본값 300kg
- **전면적**: 기본값 0.95m²
- **항력계수**: 기본값 0.14
- **태양전지판 면적**: 기본값 6.0m²
- **태양전지판 효율**: 기본값 21.5%
- **MPPT 효율**: 기본값 98%
- **에너지 효율**: 기본값 10km/kWh

### 주행 파라미터
- **평균 속도**: 기본값 60km/h
- **일일 주행 시간**: 기본값 8시간
- **WSC 총 거리**: 3022km
- **컨트롤 스탑 정차 시간**: 기본값 0.5시간
- **배터리 임계값**: 기본값 25% (이 값 이하일 때 충전 필요)
- **충전 시간**: 기본값 2시간

### 배터리 사양
- **공칭 전압**: 93.6V
- **용량**: 31.5Ah
- **에너지**: 2.9484kWh
- **최대 방전 출력**: 7.488kW

### 모터 사양
- **공칭 출력**: 2.0kW
- **최대 출력**: 5.0kW
- **효율**: 95%
- **공칭 회전속도**: 810rpm

## 4. 알고리즘 흐름

시뮬레이션의 주요 알고리즘 흐름은 다음과 같습니다:

### 4.1. 경로 계획 생성 (createRouteItinerary)

1. 시뮬레이션 파라미터 설정
2. 컨트롤 스탑 및 지형 데이터 로드
3. 일일 주행 반복 루프:
   - 현재 날짜 설정
   - 세그먼트 플래너로 일일 세그먼트 생성
   - 태양광 발전량 계산 및 적용
   - 배터리 상태 업데이트
   - 다음날 아침 충전 적용
4. 시뮬레이션 결과 종합 및 반환

### 4.2. 일일 세그먼트 계획 (planDailySegments)

1. 하루 주행을 위한 변수 초기화 (시작 시간 10:00 AM)
2. 현재 위치 이후의 컨트롤 스탑 필터링
3. 주행 세그먼트 반복 루프:
   - 다음 세그먼트 거리 결정 (컨트롤 스탑, 배터리 상태, 시간 제약 고려)
   - 세그먼트 에너지 소비 및 생산 계산
   - 배터리 상태 업데이트
   - 주행 세그먼트 생성 및 추가
   - 컨트롤 스탑 도달 시 처리
   - 배터리 충전 필요 시 충전 세그먼트 추가
4. 일일 세그먼트 계획 결과 반환

### 4.3. 에너지 소비량 계산 (calculateSegmentEnergyConsumption)

1. 주행 시간 계산 (거리/속도)
2. 해당 위치의 경사도 계산
3. 모터 에너지 소비량 계산
4. 보조 장치 소비량 계산
5. 총 에너지 소비량 계산 및 반환

### 4.4. 모터 에너지 소비 계산 (calculateEnergyConsumption)

1. 주행 저항력 계산:
   - 공기저항: 0.5 * 공기밀도 * 전면적 * 항력계수 * 속도²
   - 구름저항: 구름저항계수 * 차량중량
   - 경사저항: 차량중량 * sin(경사각)
2. 필요 동력 계산: 저항력 * 속도
3. 모터 효율 적용
4. 에너지 소비량 계산: 필요 동력 * 주행 시간

### 4.5. 태양광 발전량 계산 (calculateSegmentEnergyProduction)

1. 주행 시간에 비례하는 발전량 계산
2. 효율 손실 반영 (패널 먼지, 온도 영향 등)
3. 실효 발전량 계산 및 반환

### 4.6. 배터리 상태 업데이트 (updateBatteryLevel)

1. 순 에너지 변화 계산: 발전량 - 소비량
2. 순 에너지 변화를 배터리 퍼센트로 변환
3. 배터리 레벨 업데이트 (0-100% 사이로 제한)
4. 배터리 상태 업데이트 결과 반환

### 4.7. 배터리 충전 모델링

#### 아침 충전 (calculateMorningCharge)
1. 아침 충전 시간 (기본 4시간) 동안의 발전량 계산
2. 배터리 충전 상태 업데이트

#### 충전 정지 시 충전 (calculateChargingStopBatteryLevel)
1. 충전 시간에 따른 배터리 충전량 계산
2. CC-CV 충전 모델 적용 (정전류-정전압 충전)
3. 업데이트된 배터리 레벨 반환

## 5. 현실적 시뮬레이션을 위한 조정

시뮬레이션은 다음과 같은 현실적인 조정을 적용합니다:

1. **최소 소비량 보장**: 경로당 최소 0.1kWh는 소비한다고 가정
2. **모터 효율 모델링**: 부하에 따른 효율 변화 적용 (30% 이하 부하에서는 효율이 낮고, 30~80% 부하에서 최고 효율, 80% 이상 부하에서 약간 감소)

## 6. 시뮬레이션 제약 조건

시뮬레이션은 다음과 같은 제약 조건을 가집니다:

1. **최대 시뮬레이션 일수**: 30일 (무한 루프 방지)
2. **배터리 임계값**: 25% 이하일 때 충전 필요 (사용자 조정 가능)
3. **일일 주행 제한**: 8시간 (사용자 조정 가능)
4. **날씨 데이터 범위**: 2023-08-18 ~ 2023-09-15 (해당 범위의 데이터 사용)

## 7. 결과 분석 및 출력

시뮬레이션 결과는 다음 정보를 포함합니다:

1. **일일 주행 계획**: 각 일자별 세그먼트 정보
2. **총 에너지 생산량**: 전체 주행 기간 동안의 태양광 발전량
3. **총 에너지 소비량**: 전체 주행 기간 동안의 에너지 소비량
4. **총 충전 시간**: 배터리 충전에 소요된 총 시간
5. **평균 배터리 레벨**: 주행 기간 동안의 평균 배터리 잔량
6. **예상 도착일**: 목적지 도달 예상 일자
7. **완주 가능성**: 주어진 조건에서 완주 가능 여부

## 8. 개선 및 최적화 가능성

시뮬레이션은 다음과 같은 개선 및 최적화 가능성을 가집니다:

1. **주행 속도 최적화**: 배터리 상태에 따른 주행 속도 조정
2. **충전 전략 최적화**: 최적의 충전 타이밍 및 시간 도출
3. **날씨 데이터 정확도 향상**: 더 정확한 날씨 데이터 사용
4. **지형 데이터 정밀화**: 더 상세한 지형 정보 활용
5. **배터리 모델 정밀화**: 온도 영향 등 추가 요소 고려

이 시뮬레이션은 태양광 자동차 대회 참가팀의 전략 수립과 차량 설계 최적화에 도움이 될 수 있습니다.
